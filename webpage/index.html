<!DOCTYPE html>
<html lang="en">

<head>
	<title>Tennis Tournament Data</title>
	<meta charset="utf-8">

	<!-- You can also define the contents of the file inside a <style> tag -->
	<link rel="stylesheet" href="style.css">
</head>

<body>
	<nav>
		<h1>Tennis Tournament Data</h1>
		<a href="./index.html">Find a Player</a>
		<a href="./tournaments.html">Find a Tournament</a>
		<a href="./playerStats.html">Find Aggregated Player Statistics</a>
	</nav>
	<h1>Find all information on a player</h1>
	<!-- We will populate this list via the database, see Javascript code below -->

	<label class="input-label" for="fname">First name:</label>
	<br>
	<!-- Use "value" instead of "placeholder" for a default entered value -->
	<!-- Note the required attribute here, but not in the last name -->
	<!-- id is the local name for DOM manipulation; name is the name posted to the server -->
	<input type="text" id="fname" name="fname" placeholder="Kei Nishikori" required><br><br>
	
	<div class="center">
		<div class="button-wrapper">
			<button onclick="fetchData()"> Click to display a player </button>
			<button onclick="clearTable()"> Click to clear the table</button><br><br>
		</div>
		
		<table class="result-table" id="myTable">
			<tr>
				<th>Player ID</th>
				<th>Name</th>
				<th>Hand</th>
				<th>Height</th>
				<th>IOC</th>
			</tr>
		</table>
	</div>
</body>

<script>
	function fetchData() {
		// package into URL search params
		let playerName = document.getElementById("fname").value;
		let playerNameURL = new URLSearchParams({player_name: playerName});
		
		let URLstring = "/playerAttributes?" + playerNameURL

		const responsePromise = fetch(URLstring, {
			method: "GET",
			headers: {
				"Content-type": "application/json; charset=UTF-8"
			}
		});

		responsePromise.then(
			// Fulfilled
			async (response) => {
				populateTable(await response.json())
			},
			// Error
			(error) => {
				alert("Cannot obtain players")
			})
	}

	// For testing in the HTML world
	// <!-- <button type="button" onclick="populateList([['a', 'b'], ['c', 'd']])"> -->
	function populateTable(results) {
		let table = document.getElementById("myTable")

		results.forEach(element => {
			let player = table.insertRow(-1);
			let player_id = player.insertCell(0);
			let name = player.insertCell(1);
			let hand = player.insertCell(2);
			let height = player.insertCell(3);
			let ioc = player.insertCell(4);

			player_id.innerText = element.player_id;
			name.innerText = element.player_name;
			hand.innerText = element.player_hand;
			height.innerText = element.player_height;
			ioc.innerText = element.player_ioc;
		})
	}

    function clearTable() {
        let myTable = document.getElementById("myTable");

        for(let i = myTable.rows.length - 1; i > 0; i--){
            myTable.deleteRow(i);
        }
    }
</script>

</html>